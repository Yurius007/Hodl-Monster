openapi: 3.0.3
info:
  title: Hodl Monster API
  description: API for managing NFT-based token locks on various blockchain networks
  version: 2.0.0
  contact:
    name: Hodl Monster Team

servers:
  - url: http://localhost:5000
    description: Local development server
  - url: /
    description: Relative URLs (recommended for Swagger UI)

tags:
  - name: Chains
    description: Chain configuration and information
  - name: Tokens
    description: Token information and balances
  - name: Locks
    description: NFT Lock management
  - name: Transactions
    description: Transaction encoding endpoints

paths:
  /api/chains:
    get:
      summary: Get available chains
      description: Returns a list of all available blockchain networks with valid deployments
      tags:
        - Chains
      responses:
        '200':
          description: Successfully retrieved available chains
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  chains:
                    type: array
                    items:
                      type: object
                      properties:
                        key:
                          type: string
                          example: "base-sepolia"
                        route:
                          type: string
                          example: "base-sepolia"
                        chainId:
                          type: integer
                          example: 84532
                        chainName:
                          type: string
                          example: "Base Sepolia Testnet"

  /api/{chain}/config:
    get:
      summary: Get chain configuration
      description: Returns configuration details for a specific blockchain network
      tags:
        - Chains
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      responses:
        '200':
          description: Successfully retrieved chain configuration
          content:
            application/json:
              schema:
                type: object
                properties:
                  chainId:
                    type: integer
                    example: 84532
                  chainName:
                    type: string
                    example: "Base Sepolia Testnet"
                  contractAddress:
                    type: string
                    example: "0x2fffd91E32169F34e548359E506637EBAb8B8386"
                  testTokenAddress:
                    type: string
                    example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"
                  rpc:
                    type: string
                    example: "https://base-sepolia-rpc.publicnode.com"
                  blockExplorerUrl:
                    type: string
                    example: "https://sepolia.basescan.org"
                  isNFT:
                    type: boolean
                    example: true
                  abi:
                    type: array
                    items:
                      type: object
        '404':
          description: Chain not found

  /api/{chain}/token-info/{token}:
    get:
      summary: Get token information
      description: Returns information about a specific ERC20 token including symbol, name, and decimals
      tags:
        - Tokens
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
        - name: token
          in: path
          required: true
          description: Token contract address
          schema:
            type: string
            example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"
      responses:
        '200':
          description: Successfully retrieved token information
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  symbol:
                    type: string
                    example: "USDT"
                  decimals:
                    type: integer
                    example: 18
                  name:
                    type: string
                    example: "Tether USD"
        '400':
          description: Invalid token address or contract error
        '404':
          description: Chain not found

  /api/{chain}/token-balance/{token}/{address}:
    get:
      summary: Get token balance
      description: Returns the token balance for a specific address
      tags:
        - Tokens
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
        - name: token
          in: path
          required: true
          description: Token contract address
          schema:
            type: string
            example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"
        - name: address
          in: path
          required: true
          description: User wallet address
          schema:
            type: string
            example: "0x0000000000000000000000000000000000000000"
      responses:
        '200':
          description: Successfully retrieved token balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  balance:
                    type: string
                    example: "1000000000000000000"
        '400':
          description: Invalid address or token
        '404':
          description: Chain not found

  /api/{chain}/tokens-batch:
    post:
      summary: Batch fetch token info and balances
      description: Fetch details and balances for multiple tokens in a single request (optimized with Multicall3)
      tags:
        - Tokens
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tokens:
                  type: array
                  items:
                    type: string
                  example: ["0xToken1...", "0xToken2..."]
                user:
                  type: string
                  description: Optional user address to fetch balances for
                  example: "0xUser..."
      responses:
        '200':
          description: Successfully retrieved batch token info
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  tokens:
                    type: object
                    additionalProperties:
                      type: object
                      properties:
                        symbol:
                          type: string
                        decimals:
                          type: integer
                        name:
                          type: string
                        balance:
                          type: string
                          description: Balance in wei (if user provided)

  /api/{chain}/all-locks/{address}:
    get:
      summary: Get all user locks (NFTs)
      description: Returns all NFT-based locks for a user (optimized with Multicall3)
      tags:
        - Locks
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
        - name: address
          in: path
          required: true
          description: User wallet address
          schema:
            type: string
            example: "0x0000000000000000000000000000000000000000"
      responses:
        '200':
          description: Successfully retrieved all user locks
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  tokenCount:
                    type: integer
                    example: 3
                  locks:
                    type: array
                    items:
                      type: object
                      properties:
                        tokenId:
                          type: integer
                          example: 1
                        unlockTime:
                          type: integer
                          example: 1735689600
                        tokenCount:
                          type: integer
                          example: 1
                        tokens:
                          type: array
                          items:
                            type: object
                            properties:
                              token:
                                type: string
                              tokenSymbol:
                                type: string
                              tokenName:
                                type: string
                              tokenDecimals:
                                type: integer
                              amount:
                                type: string
        '400':
          description: Contract not deployed or invalid parameters
        '404':
          description: Chain not found

  /api/{chain}/lock/{token_id}:
    get:
      summary: Get lock details
      description: Returns details for a specific Lock NFT
      tags:
        - Locks
      parameters:
        - name: chain
          in: path
          required: true
          schema:
            type: string
        - name: token_id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Successfully retrieved lock details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  tokenId:
                    type: integer
                  owner:
                    type: string
                  unlockTime:
                    type: integer
                  claimed:
                    type: boolean
                  tokens:
                    type: array
                    items:
                      type: object
                      properties:
                        token:
                          type: string
                        amount:
                          type: string

  /api/{chain}/encode/approve:
    post:
      summary: Encode approve transaction
      description: Generates encoded transaction data for approving token spending
      tags:
        - Transactions
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - amount
              properties:
                token:
                  type: string
                  description: Token contract address
                  example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"
                amount:
                  type: string
                  description: Amount to approve (in wei)
                  example: "1000000000000000000"
      responses:
        '200':
          description: Successfully encoded approve transaction
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Encoded transaction data
                    example: "0x095ea7b3..."
                  to:
                    type: string
                    description: Target contract address
                    example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"

  /api/{chain}/encode/lock:
    post:
      summary: Encode lock tokens transaction
      description: Generates encoded transaction data for locking tokens (supports single or multi-token)
      tags:
        - Transactions
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - lockPeriod
                - beneficiary
              properties:
                token:
                  type: string
                  description: Token contract address (Single lock)
                amount:
                  type: string
                  description: Amount to lock (Single lock)
                tokenAddresses:
                  type: array
                  items:
                    type: string
                  description: Array of token addresses (Multi-lock)
                amounts:
                  type: array
                  items:
                    type: string
                  description: Array of amounts (Multi-lock)
                lockPeriod:
                  type: integer
                  description: Lock period in seconds
                  example: 2592000
                beneficiary:
                  type: string
                  description: Beneficiary wallet address
                  example: "0x0000000000000000000000000000000000000000"
      responses:
        '200':
          description: Successfully encoded lock transaction
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Encoded transaction data
                  to:
                    type: string
                    description: Target contract address
                  tokenCount:
                    type: integer
                    description: Number of tokens being locked

  /api/{chain}/encode/claim:
    post:
      summary: Encode claim tokens transaction
      description: Generates encoded transaction data for claiming an NFT lock
      tags:
        - Transactions
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - tokenId
              properties:
                tokenId:
                  type: integer
                  description: ID of the Lock NFT to claim
                  example: 1
      responses:
        '200':
          description: Successfully encoded claim transaction
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: string
                    description: Encoded transaction data
                  to:
                    type: string
                    description: Target contract address

  /api/{chain}/encode/mint:
    post:
      summary: Encode mint tokens transaction
      description: Generates encoded transaction data for minting test tokens
      tags:
        - Transactions
      parameters:
        - name: chain
          in: path
          required: true
          description: Chain route identifier
          schema:
            type: string
            example: "base-sepolia"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Token contract address
                  example: "0x962d47612fA2982bfE4074D3C8B30012E72C6EdC"
      responses:
        '200':
          description: Successfully encoded mint transaction
          content:
            application/json:
              schema:
                type: object

components:
  schemas:
    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        error:
          type: string
          example: "Error message details"
